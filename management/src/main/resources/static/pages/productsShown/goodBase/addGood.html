<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>添加商品</title>
    <link rel="stylesheet" type="text/css" media="screen" href="../../../css/bootstrap.min.css">
    <link rel="stylesheet" href="../../../layui/css/layui.css" media="all"/>
    <link rel="stylesheet" href="../../../css/global.css" media="all"/>
    <link rel="stylesheet" href="../../../css/font-awesome/css/font-awesome.css" media="all"/>
</head>
<body>
<div class="layui-body" style="bottom: 0; top: 5px; left: 5px; right: 5px; border: solid 1px #5f5f5f;"
     id="admin-body">
    <div class="layui-tab admin-nav-card layui-tab-brief">
        <ul class="layui-tab-title">
            <li class="layui-this">商品基础信息</li>
            <li>商品信息</li>
            <li id="discountInfo" style="display: none;">商品优惠信息</li>
            <li>商品配送信息</li>
            <li>商品详情</li>
        </ul>
        <div class="layui-tab-content" style="padding: 5px 0 0 0;">
            <div class="layui-tab-item layui-show">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                    <form class="form-horizontal" onsubmit="return false" id="form1">
                        <fieldset>
                            <div class="form-group">
                                <label class="col-md-2 control-label">appId</label>
                                <div class="col-md-10">
                                    <input class="form-control" type="text" name="appId" id="appId"
                                           data-bv-notempty="true" data-bv-notempty-message="app id不能為空">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">分類</label>
                                <div class="col-md-10">
                                    <select name="categoryId" class="form-control input-sm" id="categoryId"
                                            data-bv-notempty="true" data-bv-notempty-message="分類 不能為空">
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">商品名</label>
                                <div class="col-md-10">
                                    <input class="form-control" type="text" name="goodName"
                                           id="goodName"
                                           data-bv-notempty="true" data-bv-notempty-message="商品名 不能為空">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">價格區間</label>
                                <div class="col-md-10">
                                    $ <input class="form-control-money" type="number" name="goodMinPrice"
                                             id="goodMinPrice" value=0.00 step="0.01"> -
                                    $ <input class="form-control-money" type="number" name="goodMaxPrice"
                                             id="goodMaxPrice" value=0.00 step="0.01">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">是否特價</label>
                                <div class="col-md-10">
                                    <input type="checkbox" name="isSpecialPrice" id="isSpecialPrice">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label" id="specialPriceTitle"
                                       style="display: none;">特價價格</label>
                                <div class="col-md-10" id="specialPriceDiv" style="display: none;">
                                    $ <input class="form-control-money" type="number" name="specialPrice"
                                             id="specialPrice" value=0.00 step="0.01">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">是否有折扣</label>
                                <div class="col-md-10">
                                    <input type="checkbox" name="isDiscount" id="isDiscount">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">庫存</label>
                                <div class="col-md-10">
                                    <input class="form-control" type="number" name="stock"
                                           id="stock" value=0>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">售賣時間</label>
                                <div class="col-md-10">
                                    <input class="form-control" name="sellTime"
                                           id="sellTime" data-bv-notempty="true" data-bv-notempty-message="售賣時間 不能為空">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">售賣狀態</label>
                                <div class="col-md-10">
                                    <select name="sellStatus" class="form-control input-sm" id="sellStatus"
                                            data-bv-notempty="true" data-bv-notempty-message="售賣狀態 不能為空">
                                    </select>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
            <div class="layui-tab-item">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                    <form class="form-horizontal" onsubmit="return false" id="form2">
                        <fieldset>
                            <div class="form-group">
                                <label class="col-md-2 control-label">商品描述</label>
                                <div class="col-md-10">
                                    <textarea class="form-control" type="text" name="goodDescribe" id="goodDescribe" style="height: 200px"></textarea>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">商品規格</label>
                                <div class="col-md-10">
                                    <input class="form-control" type="text" name="goodSize" id="goodSize">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">公司</label>
                                <div class="col-md-10">
                                    <select name="companyId" class="form-control input-sm" id="companyId"></select>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
            <div class="layui-tab-item">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                    <form class="form-horizontal" onsubmit="return false" id="form3" style="display: none;">
                        <fieldset>
                            <div class="form-group">
                                <label class="col-md-2 control-label">打多少折</label>
                                <div class="col-md-10">
                                   - <input class="form-control-money" type="number" name="discountOff"
                                           id="discountOff" value=0 step="1"> %
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="col-md-2 control-label">滿多少錢</label>
                                <div class="col-md-10">
                                    $ <input class="form-control-money" type="number" name="fullPrice"
                                             id="fullPrice" value=0.00 step="0.01">
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
            <div class="layui-tab-item">
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                    <form class="form-horizontal" onsubmit="return false" id="form4">
                        <fieldset>
                            {empty name="$deliverWay"}
                            <div class="form-group">
                                <label class="col-md-2 control-label">配送方式</label>
                                <div class="col-md-10">
                                    <select name="deliverWay[]" class="form-control input-sm" id="deliverWay[0]" style="width: 25%;"></select>
                                </div>
                                <div class="layui-input-block">
                                    <button id="addWay" type="button" class="layui-btn layui-btn-warm layui-btn-sm">
                                        <i class="layui-icon">&#xe654;</i>
                                    </button>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
            </div>
            <div class="layui-tab-item">5</div>
        </div>
    </div>
    <div class="form-actions">
        <div class="row" align="center">
            <div class="col-md-12">
                <button class="btn btn-primary" onclick="location.href='goodList.html'">返回
                </button>
                <button class="btn btn-primary" type="submit" onclick="add()">
                    <i class="fa fa-save"></i> 保存
                </button>
            </div>
        </div>
    </div>
</div>
</body>
</html>
<script type="text/javascript" src="../../../js/libs/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="../../../js/jq.js"></script>
<script type="text/javascript" src="../../../js/plugin/bootstrapvalidator/bootstrapValidator.min.js"></script>
<script type="text/javascript" src="../../../js/common.js"></script>
<script type="text/javascript" src="../../../layui/layui.js"></script>
<script type="text/javascript" src="../../../js/dict.js"></script>
<script type="text/javascript">
    layui.use(['layer', 'laydate'], function () {
        var layer = layui.layer;
    });
    layui.use('laydate', function () {
        var laydate = layui.laydate;

        //执行一个laydate实例
        laydate.render({
            elem: '#sellTime' //指定元素
            , type: 'datetime'
            , format: 'yyyy-MM-dd HH:mm:ss'
        });
    });
    initData();
    var appId = $('#appId').val().toString();
    showCategoryByAppId("categoryId", "categoryName", "", appId);
    showCompanyByAppId("companyId", "companyId", "", appId);
    showDictSelect("sellStatus", "sellStatus", "");
    showDictSelect("deliverWay", "deliverWay", "");
    $('#goodMinPrice').blur(function () {
        var minPrice = $('#goodMinPrice').val();
        var maxPrice = $('#goodMaxPrice').val();
        if (minPrice > maxPrice) {
            $('#goodMaxPrice').val(minPrice);
        }
    });
    $('#goodMaxPrice').blur(function () {
        var minPrice = $('#goodMinPrice').val();
        var maxPrice = $('#goodMaxPrice').val();
        if (minPrice > maxPrice) {
            $('#goodMaxPrice').val(minPrice);
        }
    });
    $('#discountOff').blur(function () {
        var discountOff = $('#discountOff').val();
        if (discountOff > 100) {
            $('#discountOff').val(100);
        }
    });
    $(function () {
        $("#isSpecialPrice").click(function () {
            if (this.checked == true) {
                $('#specialPriceDiv').show();
                $('#specialPriceTitle').show();
                $('#specialPrice').val(0);
            } else {
                $('#specialPriceDiv').hide();
                $('#specialPriceTitle').hide();
                $('#specialPrice').val(null);
            }
        });
    });
    $(function () {
        $("#isDiscount").click(function () {
            if (this.checked == true) {
                $('#discountInfo').show();
                $('#form3').show();
                $('#discountOff').val(0);
                $('#fullPrice').val(0);
            } else {
                $('#discountInfo').hide();
                $('#form3').hide();
                $('#discountOff').val(null);
                $('#fullPrice').val(null);
            }
        });
    });

    function initData() {
        $.ajax({
            type: 'get',
            url: '/applet/appId',
            async: false,
            success: function (data) {
                $('#appId').val(data);
                if (data != null && data !== "") {
                    document.getElementById("appId").readOnly = true;
                }
            }
        });
    }

    function add() {
        if ($('#isSpecialPrice').val() === ("on")) {
            $('#isSpecialPrice').val(1);
        } else if ($('#isSpecialPrice').val() === ("off")) {
            $('#isSpecialPrice').val(0);
        }
        if ($('#isDiscount').val() === ("on")) {
            $('#isDiscount').val(1);
        } else if ($('#isDiscount').val() === ("off")) {
            $('#isDiscount').val(0);
        }
        $('#form1').bootstrapValidator();
        var bootstrapValidator = $("#form1").data('bootstrapValidator');
        bootstrapValidator.validate();
        if (!bootstrapValidator.isValid()) {
            return;
        }
        $('#form2').bootstrapValidator();
        var bootstrapValidator = $("#form2").data('bootstrapValidator');
        bootstrapValidator.validate();
        if (!bootstrapValidator.isValid()) {
            return;
        }
        $('#form3').bootstrapValidator();
        var bootstrapValidator = $("#form3").data('bootstrapValidator');
        bootstrapValidator.validate();
        if (!bootstrapValidator.isValid()) {
            return;
        }
        var formData = $("#form1").serializeObject();
        var formData = $("#form2").addSerializeObject(formData);
        var formData = $("#form3").addSerializeObject(formData);
        $.ajax({
            type: 'post',
            url: '/productsShown/good',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(formData),
            success: function (data) {
                layer.msg("添加成功", {shift: -1, time: 1000}, function () {
                    location.href = "goodList.html";
                });
            }
        });
    }

    layui.use(['layer', 'element'], function () {
        var $ = layui.jquery,
            layer = layui.layer;
        var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块

        //iframe自适应
        function resize() {
            var $content = $('.admin-nav-card .layui-tab-content');
            $content.height($(this).height() - 147);
            $content.find('iframe').each(function () {
                $(this).height($content.height());
            });
        }

        $(window).on('resize', function () {
            var $content = $('.admin-nav-card .layui-tab-content');
            $content.height($(this).height() - 147);
            $content.find('iframe').each(function () {
                $(this).height($content.height());
            });
        }).resize();
        //toggle左侧菜单
        $('.admin-side-toggle').on('click', function () {
            var sideWidth = $('#admin-side').width();
            if (sideWidth === 200) {
                $('#admin-body').animate({
                    left: '0'
                });
                $('#admin-footer').animate({
                    left: '0'
                });
                $('#admin-side').animate({
                    width: '0'
                });
            } else {
                $('#admin-body').animate({
                    left: '200px'
                });
                $('#admin-footer').animate({
                    left: '200px'
                });
                $('#admin-side').animate({
                    width: '200px'
                });
            }
        });
        //手机设备的简单适配
        var treeMobile = $('.site-tree-mobile'),
            shadeMobile = $('.site-mobile-shade');
        treeMobile.on('click', function () {
            $('body').addClass('site-mobile');
        });
        shadeMobile.on('click', function () {
            $('body').removeClass('site-mobile');
        });
    });
</script>